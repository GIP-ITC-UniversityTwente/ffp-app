import{attachmentTemplate,dateFormat_dMY}from"../../common/tools";import{ApprovalCtrl}from"./ApprovalController";var PartyFormCtrl={appEvent:!0,onSuggestHide:()=>{var t=$$("pf:party_search").getValue();!t||(t=$$("pf:search_list").getList().getItem(t))&&PartyFormCtrl.onPartySelected(t.id_number,t.oid_list[0])},beforeListLoad:()=>{var t=$$("pf:party_search").getText();if(""==t||"["==t[0]||t.length<3)return!1},onComboKeyPress:t=>{-1!=$$("pf:party_search").getText().indexOf("cc:")&&(38==t&&40==t||27!=t&&13!=t&&(PartyFormCtrl.resetPartyForm(),$$("pf:search_list").getBody().clearAll()))},resetPartyForm:t=>{t||($$("pf:party_search").setValue(null),$$("pf:search_list").getList().clearAll()),$$("apv:party_form").clear(),$$("apv:party_form").clearValidation();let e=$$("pf:attachment_tab");e.getOption("pf:facephoto").value='<span class="mdi mdi-account-box-multiple"></span>',e.getOption("pf:iddoc").value='<span class="mdi mdi-card-account-details-outline"></span>',e.refresh(),$$("pf:attachment_cnt").setValue("pf:facephoto"),$$("pf:attachment_tab").setValue("pf:facephoto");var a=[{data:{src:"images/blank.gif",alt:""},template:attachmentTemplate}],t=webix.copy(a);webix.ui(a,$$("pf:facephoto_carousel")),webix.ui(t,$$("pf:iddoc_carousel")),ApprovalCtrl.currentParty=null,ApprovalCtrl.partyDataFromDB=!0,ApprovalCtrl.newAttachments={facephoto:!1,iddoc:!1,fingerprint:!1},PartyFormCtrl.appEvent=!0,ApprovalCtrl.checkPartyChecked=!1,$$("pf:edit_btn").disable()},onPartySelected:(t,e)=>{ApprovalCtrl.currentParty&&PartyFormCtrl.resetPartyForm(!0);t={objectid:e,id_number:t};webix.ajax().get("api/party/data/",{...appdata.dbparams,...t}).then(t=>{t.json().success?(ApprovalCtrl.currentParty=t.json().records[0],null!=e&&(ApprovalCtrl.currentParty.oid_list=$$("pf:search_list").getList().getItem($$("pf:party_search").getValue()).oid_list),ApprovalCtrl.showPartyData()):showErrorMsg(null,t.json().message)},t=>{showErrorMsg(t,"")})},toggleDataChecked:t=>{let e=`<span class="pending">&nbsp; <i>${__("Pending")}...</i></span>`;1==t&&0==ApprovalCtrl.currentParty.checked_on&&($$("apv:party_form").validate()?"images/blank.gif"==$$("pf:facephoto_carousel").getChildViews()[0].getChildViews()[0].config.data.src?(PartyFormCtrl.appEvent=!1,$$("pf-date_checked").setValue(0),ApprovalCtrl.checkPartyChecked=!0,ApprovalCtrl.requestPartyAttachment("facephoto")):"images/blank.gif"==$$("pf:iddoc_carousel").getChildViews()[0].getChildViews()[0].config.data.src?(PartyFormCtrl.appEvent=!1,$$("pf-date_checked").setValue(0),ApprovalCtrl.checkPartyChecked=!0,ApprovalCtrl.requestPartyAttachment("iddoc")):(e="<b>"+dateFormat_dMY(new Date)+"</b>",ApprovalCtrl.checkPartyChecked=!0):$$("pf-date_checked").setValue(0)),$$("pf-date_checked").define("labelRight",__("Data checked on: ")+e),$$("pf-date_checked").refresh()},onIdentytyValidated:function(t){(ApprovalCtrl.currentParty.validated=t)?($$("apv:search_cnt").disable(),$$("pf:approval_btn").enable(),$$("pf:edit_btn").disable()):($$("apv:search_cnt").enable(),$$("pf:approval_btn").disable(),$$("pf:edit_btn").enable())}};export{PartyFormCtrl};