import{showErrorMsg}from"../../common/tools";import{Codelist}from"../../common/codelists";import{ConceptPieColor}from"../shared/colors";var DashboardCtrl={refreshView:!1,sridChanged:!1,gauge:null,initGauge:()=>{var r=$$("dsh:gauge_chart").$width;function e(){var e=Math.min(d3.select("#gauge-chart").node().offsetWidth,r);DashboardCtrl.gauge.width(e).innerRadius(e/4).outerRadius(e/4+25),d3.select("#gauge-chart").call(DashboardCtrl.gauge)}DashboardCtrl.gauge=gaugeChart().width(r).height(200).innerRadius(50).outerRadius(50).margin({top:5,right:10,bottom:0,left:10}),d3.select("#gauge-chart").datum([0]).call(DashboardCtrl.gauge),e(),$$("dsh:gauge_chart").resizeFunction=e},onViewShow:()=>{var e;(DashboardCtrl.refreshView||DashboardCtrl.sridChanged)&&(e={srid:appdata.srid},webix.ajax().get("api/dashboard/data/",{...appdata.dbparams,...e}).then(e=>{e.json().success?DashboardCtrl.updateFigures(e.json()):showErrorMsg(null,e.json().message)},e=>{showErrorMsg(e,"")}),DashboardCtrl.refreshView=!1),DashboardCtrl.sridChanged&&(webix.message({type:"success",text:__("Some values were recalculated to reflect the SRID change"),expire:2500}),DashboardCtrl.sridChanged=!1)},updateFigures:e=>{var r=e.details;let t,a,s;var i=5e3;s=r.total_area<i?(t=__("Square Meters<br />Covered"),a=String(r.total_area),0):(t=__("Hectares<br />Covered"),a=String(r.total_area/1e4),1),document.getElementById("dsh-hectares_text").innerHTML=webix.Number.format(a,{decimalSize:s,decimalDelimiter:"."})+"<br />"+t,document.getElementById("dsh-spatialunits_text").innerHTML=r.num_spatialunits+"<br />"+__("Spatialunits<br />Surveyed"),document.getElementById("dsh-parties_text").innerHTML=r.num_parties+"<br />"+__("Rightholders<br />Registered"),s=r.largest<i?(t="&nbsp;m<sup>2</sup>",a=String(r.largest),0):(t="&nbsp;has",a=String(r.largest/1e4),1),document.getElementById("dsh-largest_text").innerHTML=__("Largest<br />Spatialunit")+"<br />"+webix.Number.format(a,{decimalSize:s,decimalDelimiter:"."})+t,s=r.average_size<i?(t="&nbsp;m<sup>2</sup>",a=String(r.average_size),0):(t="&nbsp;has",a=String(r.average_size/1e4),1),document.getElementById("dsh-average_text").innerHTML=__("Average<br />Spatialunit Size")+"<br />"+webix.Number.format(a,{decimalSize:s,decimalDelimiter:"."})+t,s=r.smallest<i?(t="&nbsp;m<sup>2</sup>",a=String(r.smallest),0):(t="&nbsp;has",a=String(r.smallest/1e4),1),document.getElementById("dsh-smallest_text").innerHTML=__("Smallest<br />Spatialunit")+"<br />"+webix.Number.format(a,{decimalSize:s,decimalDelimiter:"."})+t,e.progress.find(e=>"processed"==e.status)||e.progress.push({status:"processed",count:0});var d,o,r=e.progress.find(e=>"processed"==e.status).count/e.progress.reduce((e,r)=>e.count+r.count)*100;d3.select("#gauge-chart").datum([r]).call(DashboardCtrl.gauge);for(d of e.gender_dist)d.gender=Codelist("gender",d.id);$$("dsh:gender_chart").parse(e.gender_dist);for(o of e.status)o.color=ConceptPieColor(o.concept);$$("dsh:boundary_pie").parse(e.status);var n=new Array;n.push({}),e.tenure.forEach(e=>{n.push({view:"template",css:"dsh-right_box",width:120,template:`<div><span>
                            ${Codelist("righttype",e.right_type)} &ndash;
                            <b><em>${e.count}</em></b>
                        </span></div>`,role:"placeholder"}),n.push({})}),webix.ui(n,$$("dsh:tenure_list"))}};export{DashboardCtrl};